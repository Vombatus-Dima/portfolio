
## Содержание
- [Описание](#описание)
- [Блоки устройства](#устройство-содержит-следующие-блоки)
- [Назначение](#назначение-устройства)
- [Функции](#основная-программа-выполняет-следующие-функции)
- [Схема](#принципиальная-схема)
- [Сборочный](#сборочный)
- [Вид платы в сборе](#фото-платы-сверху)

## Описание

Данный репозиторий содержит данные по модулю выбранному в качестве портфолио к резюме. 

Устройство разработано мной начиная с формирования ТЗ, выполнена разработки принципиальной схемы, КД печатной платы, программное обеспечение загрузчика и основной программы, запуск тестирование модулей электронной платы, сопровождение запуска малой серии и заканчивая выездом на объект для развертывания системы. 

Используется в качестве узловых элементов для системы шахтной радиосвязи и позиционирования персонала.

Для этой системы мной были также разработаны еще насколько модулей, но данное устройство получилось наиболее интересным.

## Устройство содержит следующие блоки:

1. Микроконтроллер STM32F429I.
2. Ethernet PHY на DP83848C.
2. Три аппаратных кодека CMX618L4.
3. Два независимых канала RS485/RS422 на ADM3491 c гальванической развязкой SI8631AB, P6CU.
4. CAN PHY с гальванической развязкой на ADM3053.
5. FXO PHY на базе кодека UDA1380HN c гальванической развязкой.
6. Два цифровых входа и два цифровых выхода с гальванической развязкой на CPC1035.
7. Основное питание на базе DC-DC TSR-0.5-2450/TSR-0.5-2433.
8. В схему добавлены элементы для обеспечения взрывозащиты вида «ИСКРОБЕЗОПАСНАЯ ЭЛЕКТРИЧЕСКАЯ ЦЕПЬ» класса Иа. 


## Назначение устройства

**Основное назначение**: сопряжение и маршрутизация информационных потоков, аппаратное декодирование/кодирование аудиопотоков трех независимых каналов.

Использование аппаратного кодека CMX618L4 RALCWI обусловлено тем что при низких энергетических и аппаратных затратах мы получаем сжатый аудио поток с хорошим качеством речи со скоростью 2400 бит на секунду,это позволяет получить существенное преимущество в портативной радиосвязи как по числу каналов так и по энергетическому бюджету самого радио канала.
 
Программное обеспечение реализовано на базе std peripheral library stm32f4, в качестве операционной системы выбрана FreeRTOS, используется стек TCP/IP LwIP. Состоит из двух отдельных проектов: загрузчика и основной программы. 
Загрузчик позволяет обновить основную программу по Ethernet или любому каналу из RS485/RS422. Конфигурирование загрузчика HTML или проприетарный soft. Обновление только проприетарный soft.


### Основная программа выполняет следующие функции:
  - Получение любому из интерфейсов RS, CAN, Ethernet пакетов со сжатыми аудио данными, трансляция согласно таблице маршрутизации, аппаратное декодирование аудио пакета, транслирование несжатого аудио потока согласно таблице рассылки полученной с серверов рассылки и/или транслирование в аудио кодека канала FXO.
  - Получение несжатого аудио потока по Ethernet или из аудио кодека, аппаратное кодирование и трансляция пакетов со сжатым аудио согласно таблице маршрутизации по интерфейсам RS, CAN, Ethernet.
  - Получение не аудио данных по любому из интерфейсов и трансляция согласно таблице маршрутизации и таблице рассылки.
  - Возможность переключение любого порта RS485/RS422 в режим шлюза MODBUS мастер с возможностью управления через Ethernet по протоколу MODBUS TCP.
  
Основная программа конфигурируется по аналогии с загрузчиком. Также имеется диагностический терминал, позволяющий по Ethernet или любому каналу из RS485/RS422 удаленно по запросу получить лог данных любого канала RS, CAN, Audio данные таблицу, статистику и лог маршрутизации информационных потоков, статистику задач FreeRTOS.

Для разработки загрузчика и основной программы использовалась IDE IAR ver 8.xx.

[Пример кода](https://github.com/Vombatus-Dima/portfolio/tree/main/code)



### Принципиальная схема
[Файл pdf](https://github.com/Vombatus-Dima/portfolio/blob/main/pi-5.pdf)

![Принципиальная схема](https://github.com/Vombatus-Dima/portfolio/blob/main/pi-5.jpg)

### Сборочный
[Файл pdf](https://github.com/Vombatus-Dima/portfolio/blob/main/сб_pi-5_.pdf)

![Сборочный](https://github.com/Vombatus-Dima/portfolio/blob/main/сб_pi-5_.jpg)

### Фото платы сверху
![Фото платы сверху](https://github.com/Vombatus-Dima/portfolio/blob/main/top.jpg)

### Фото платы снизу
![Фото платы снизу](https://github.com/Vombatus-Dima/portfolio/blob/main/bot.jpg)
